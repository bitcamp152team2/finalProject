<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.bit.dashBoard.mapper.DashBoardUserMapper">
    <select id="selectTaskCount" resultType="com.project.bit.dashBoard.domain.UserCountVO">
		select count(t.task_code) as user_task_count
		    from project_tasks t
		    inner join project_task_managers tm
		    on t.task_code=tm.task_code
		    join users u on tm.task_manager_id=u.user_id
		    where u.user_id=#{userId}
	</select>
	<select id="selectIssueCount" resultType="com.project.bit.dashBoard.domain.UserCountVO">
		select count(i.issue_code) as user_issue_count
			from project_issues i
			inner join users u
			on i.issue_user_id=u.user_id
			where u.user_id=#{userId}
	</select>
	<select id="selectOutputCount" resultType="com.project.bit.dashBoard.domain.UserCountVO">
		select count(o.output_code) as user_output_count
			from project_outputs o
			inner join users u
			on o.output_name=u.user_id
			where u.user_id=#{userId}
	</select>
	<select id="selectProjectCount" resultType="com.project.bit.dashBoard.domain.UserCountVO">
		select count(p.project_code) as user_project_count
			from projects p
			inner join project_members pm
			on p.project_code=pm.project_code
			join users u
			on pm.user_id=u.user_id
			where u.user_id=#{userId}
	</select>

	<!-- user task status chart -->
	<select id="selectTaskStatus" resultType="com.project.bit.dashBoard.domain.TaskStatusCountVO">
		select count(t.task_status_code) as task_status_all
			,count(case when t.task_status_code = 'taskstatus100' then 1 end) as task_status_process
			,count(case when t.task_status_code = 'taskstatus200' then 1 end) as task_status_complete
			,count(case when t.task_status_code = 'taskstatus300' then 1 end) as task_status_standBy
			from project_tasks t
			inner join project_task_managers tm
			on t.task_code=tm.task_code
			join users u on tm.task_manager_id=u.user_id
			where u.user_id=#{userId}
	</select>

	<!-- user issue status chart -->
	<select id="selectIssueStatus" resultType="com.project.bit.dashBoard.domain.IssueTypeCountVO">
		select count(i.issue_type_code) as issue_type_all
			,count(case when i.issue_type_code = 'issuetype100' then 1 end) as issue_type_change
			,count(case when i.issue_type_code = 'issuetype200' then 1 end) as issue_type_delay
			,count(case when i.issue_type_code = 'issuetype300' then 1 end) as issue_type_improve
			,count(case when i.issue_type_code = 'issuetype400' then 1 end) as issue_type_etc
			from project_issues i
			inner join users u
			on i.issue_user_id=u.user_id
			where u.user_id=#{userId}
	</select>
</mapper>